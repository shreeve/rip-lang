<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sierpinski Triangle — Rip UI</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #0a0a0a; color: white; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
    .scene { position: relative; width: 100vw; height: 100vh; }
    .stats { position: fixed; top: 20px; left: 24px; z-index: 10; }
    .stats-title { font-size: 18px; font-weight: bold; }
    .stats-line { font-size: 13px; color: rgba(255,255,255,0.45); margin-top: 3px; }
    .stats-note { font-size: 11px; color: rgba(255,255,255,0.25); margin-top: 8px; max-width: 280px; line-height: 1.5; }
    .source-toggle { display: inline-block; margin-top: 10px; padding: 4px 10px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 4px; color: rgba(255,255,255,0.5); font-family: inherit; font-size: 12px; cursor: pointer; transition: all 0.2s; }
    .source-toggle:hover { color: white; border-color: rgba(255,255,255,0.4); background: rgba(255,255,255,0.12); }
    .source-panel { position: fixed; top: 0; right: 0; bottom: 0; width: min(520px, 90vw); z-index: 100; background: rgba(10,10,10,0.92); backdrop-filter: blur(12px); border-left: 1px solid rgba(255,255,255,0.1); transform: translateX(100%); transition: transform 0.3s ease; overflow-y: auto; }
    .source-panel.open { transform: translateX(0); }
    .source-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid rgba(255,255,255,0.08); }
    .source-label { font-size: 13px; font-weight: bold; color: rgba(255,255,255,0.6); letter-spacing: 0.05em; }
    .source-close { background: none; border: none; color: rgba(255,255,255,0.4); font-size: 20px; cursor: pointer; padding: 4px 8px; border-radius: 4px; font-family: inherit; transition: all 0.2s; }
    .source-close:hover { color: white; background: rgba(255,255,255,0.1); }
    .source-code { padding: 16px 20px; font-size: 13px; line-height: 1.7; color: rgba(255,255,255,0.85); white-space: pre; overflow-x: auto; }
    .container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(var(--scale, 1)); width: 1000px; height: 870px; transform-origin: center center; }
    .dot {
      position: absolute; width: 24px; height: 24px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 10px; font-weight: bold; color: rgba(255,255,255,0.9);
      user-select: none; cursor: default; transition: transform 0.1s;
    }
    .dot:hover { transform: scale(2.5); z-index: 1; }
  </style>
  <script type="module" src="https://shreeve.github.io/rip-lang/dist/rip-ui.min.js"></script>
  <script>
    function updateScale() {
      var s = Math.min(window.innerWidth / 1350, window.innerHeight / 1250, 1);
      document.documentElement.style.setProperty('--scale', s);
    }
    updateScale();
    window.addEventListener('resize', updateScale);
  </script>
</head>
<body>
  <div class="source-panel" id="source-panel">
    <div class="source-header">
      <span class="source-label">SOURCE — 48 LINES OF RIP</span>
      <button class="source-close" onclick="document.getElementById('source-panel').classList.remove('open')">&times;</button>
    </div>
    <pre class="source-code" id="source-code"></pre>
  </div>
  <script type="text/rip">
    # Sierpinski Triangle — 729 reactive dots at 60fps
    # No virtual DOM. No tree diffing. Just fine-grained reactivity.

    App = component
      elapsed := 0
      fps := 0

      dots := do ->
        result = []
        build = (x, y, s) ->
          if s <= 25
            result.push { x, y, id: result.length }
          else
            build x        , y - s / 4, s / 2
            build x - s / 2, y + s / 4, s / 2
            build x + s / 2, y + s / 4, s / 2
        build 500, 435, 1000
        result

      mounted: ->
        start = performance.now()
        frames = 0
        last = start
        tick = ->
          now = performance.now()
          elapsed = (now - start) / 1000
          frames++
          if now - last >= 1000
            fps = frames
            frames = 0
            last = now
          requestAnimationFrame tick
        requestAnimationFrame tick

      render
        .scene
          .stats
            .stats-title "Sierpinski Triangle"
            .stats-line dots.length + " dots · " + dots.length * 2 + " reactive bindings"
            .stats-line fps + " fps"
            .stats-note "Each dot updates independently via fine-grained reactivity"
            button.source-toggle @click: (-> document.getElementById('source-panel').classList.toggle('open')), "View Source"

          .container
            for dot in dots
              .dot style: "left:" + (dot.x - 12) + "px;top:" + (dot.y - 12) + "px;background:hsl(" + ((dot.id / 729 * 360 + elapsed * 40) % 360) + " 70% 50%)"
                Math.floor(elapsed % 10) + 1

    App.new().mount document.body

    # Populate source panel with this page's own Rip source
    ripScript = document.querySelector('script[type="text/rip"]')
    lines = ripScript.textContent.split("\n")
    while lines.length and lines[0].trim() is ''
      lines.shift()
    cutoff = lines.findIndex((l) -> l.includes('Populate source panel'))
    lines = lines.slice(0, cutoff).filter((l, i, a) -> i < a.length - 1 or l.trim() isnt '')
    sourceEl = document.getElementById('source-code')
    sourceEl.textContent = lines.join("\n")
  </script>
</body>
</html>
