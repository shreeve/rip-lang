# Test: Clean Parentheses (no excessive parens in conditions)
# Tests that conditions don't have unnecessary double parentheses

# ============================================================================
# If Statement Conditions
# ============================================================================

code "if simple condition", "if x > y\n  z", "if (x > y) {\n  z;\n}"
code "if complex condition", "if x > 5 and y < 10\n  z", "if ((x > 5) && (y < 10)) {\n  z;\n}"
code "unless condition", "unless x is 5\n  y", "if (!(x === 5)) {\n  y;\n}"

# ============================================================================
# While/Until Loops
# ============================================================================

code "while condition", "while x < 10\n  x++", "while (x < 10) {\n  (x++);\n}"
code "until condition", "until x > 10\n  x++", "while (!(x > 10)) {\n  (x++);\n}"

# ============================================================================
# For Loop Guards
# ============================================================================

code "for with guard", "for x in arr when x > 5\n  x", "for (const x of arr) {\n  if (x > 5) {\n    x;\n  }\n}"

# ============================================================================
# Function Arguments (no redundant outer parens)
# ============================================================================

code "function arg simple", "fn((x + y))", "fn(x + y);"
code "function arg with or", "new Set((arr or []))", "new Set(arr || []);"
code "function arg logical", "fn((a && b))", "fn(a && b);"

# ============================================================================
# Assignment RHS (no redundant outer parens)
# ============================================================================

code "assignment simple", "x = (5 + 3)", "let x;\n\nx = 5 + 3;"
code "assignment logical", "x = (a || b)", "let x;\n\nx = a || b;"

# ============================================================================
# Array Index (no redundant outer parens)
# ============================================================================

code "array index expression", "arr[(i + 1)]", "arr[i + 1];"
code "array index with or", "arr[(len or 1)]", "arr[len || 1];"

# ============================================================================
# Must Keep Parens (Object Literals)
# ============================================================================

code "object literal in call", "fn(({x: 1}))", "fn({x: 1});"
test "object literal statement", "({x: 1})", {x: 1}

# ============================================================================
# Mixed Precedence Safety (must preserve parens for operators)
# ============================================================================

test "arithmetic with or preserves parens", "x = 5 - (3 || 2)", 2
code "arithmetic mixed precedence", "x = a - (b || c)", "let x;\n\nx = a - (b || c);"

# ============================================================================
# Postfix If/Unless with Multiple Operators (clean logical chains)
# ============================================================================

code "postfix if two conditions", "x = 5 if !isEmpty && isValid", "let x;\n\nif (!isEmpty && isValid) x = 5;"
code "postfix if three conditions", "x = 5 if !isEmpty && !isPassthrough && hasPrecedence", "let x;\n\nif (!isEmpty && !isPassthrough && hasPrecedence) x = 5;"
code "postfix if four conditions", "x = 5 if !a && !b && !c && d", "let x;\n\nif (!a && !b && !c && d) x = 5;"
code "postfix unless with ands", "x = 5 unless isEmpty || invalid", "let x;\n\nif (!(isEmpty || invalid)) x = 5;"

test "postfix if execution", "isEmpty = false; isValid = true; x = 5 if !isEmpty && isValid; x", 5
test "postfix if fails", "isEmpty = true; isValid = true; x = 5 if !isEmpty && isValid; x", undefined

# ============================================================================
# Mixed Operators in Conditions (keep inner parens, unwrap outer)
# ============================================================================

code "comparison with logical", "if (x > 5) && (y < 10) then z", "if ((x > 5) && (y < 10)) {\n  z;\n}"
test "comparison with logical execution", "x = 6; y = 8; result = 'yes' if (x > 5) && (y < 10); result", "yes"
